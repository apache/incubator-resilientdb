<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ResilientDB: raw-body</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">ResilientDB<span id="projectnumber">&#160;v1.3.1</span>
   </div>
   <div id="projectbrief">NexRes</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/d96/md__github_workspace_node_modules_raw_body_README.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">raw-body </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://npmjs.org/package/raw-body"><img src="https://img.shields.io/npm/v/raw-body.svg" alt="NPM Version" style="pointer-events: none;" class="inline"/></a> <a href="https://npmjs.org/package/raw-body"><img src="https://img.shields.io/npm/dm/raw-body.svg" alt="NPM Downloads" style="pointer-events: none;" class="inline"/></a> <a href="https://nodejs.org/en/download/"><img src="https://img.shields.io/node/v/raw-body.svg" alt="Node.js Version" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/jshttp/stream-utils/raw-body?query=workflow%3Aci"><img src="https://img.shields.io/github/workflow/status/stream-utils/raw-body/ci/master?label=ci" alt="Build status" class="inline"/></a> <a href="https://coveralls.io/r/stream-utils/raw-body?branch=master"><img src="https://img.shields.io/coveralls/stream-utils/raw-body/master.svg" alt="Test coverage" style="pointer-events: none;" class="inline"/></a></p>
<p>Gets the entire buffer of a stream either as a <code>Buffer</code> or a string. Validates the stream's length against an expected length and maximum limit. Ideal for parsing request bodies.</p>
<h1><a class="anchor" id="autotoc_md2427"></a>
Install</h1>
<p>This is a <a href="https://nodejs.org/en/">Node.js</a> module available through the <a href="https://www.npmjs.com/">npm registry</a>. Installation is done using the <a href="https://docs.npmjs.com/getting-started/installing-npm-packages-locally"><code>npm install</code> command</a>:</p>
<div class="fragment"><div class="line">$ npm install raw-body</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2428"></a>
TypeScript</h2>
<p>This module includes a <a href="https://www.typescriptlang.org/">TypeScript</a> declaration file to enable auto complete in compatible editors and type information for TypeScript projects. This module depends on the Node.js types, so install <code>@types/node</code>:</p>
<div class="fragment"><div class="line">$ npm install @types/node</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2429"></a>
API</h1>
<div class="fragment"><div class="line">var getRawBody = require(&#39;raw-body&#39;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2430"></a>
getRawBody(stream, [options], [callback])</h2>
<p><b>Returns a promise if no callback specified and global <code>Promise</code> exists.</b></p>
<p>Options:</p>
<ul>
<li><code>length</code> - The length of the stream. If the contents of the stream do not add up to this length, an <code>400</code> error code is returned.</li>
<li><code>limit</code> - The byte limit of the body. This is the number of bytes or any string format supported by <a href="https://www.npmjs.com/package/bytes">bytes</a>, for example <code>1000</code>, &lsquo;'500kb&rsquo;<code>or</code>'3mb'`. If the body ends up being larger than this limit, a <code>413</code> error code is returned.</li>
<li><code>encoding</code> - The encoding to use to decode the body into a string. By default, a <code>Buffer</code> instance will be returned when no encoding is specified. Most likely, you want <code>utf-8</code>, so setting <code>encoding</code> to <code>true</code> will decode as <code>utf-8</code>. You can use any type of encoding supported by <a href="https://www.npmjs.org/package/iconv-lite#readme">iconv-lite</a>.</li>
</ul>
<p>You can also pass a string in place of options to just specify the encoding.</p>
<p>If an error occurs, the stream will be paused, everything unpiped, and you are responsible for correctly disposing the stream. For HTTP requests, you may need to finish consuming the stream if you want to keep the socket open for future requests. For streams that use file descriptors, you should <code>stream.destroy()</code> or <code>stream.close()</code> to prevent leaks.</p>
<h1><a class="anchor" id="autotoc_md2431"></a>
Errors</h1>
<p>This module creates errors depending on the error condition during reading. The error may be an error from the underlying Node.js implementation, but is otherwise an error created by this module, which has the following attributes:</p>
<ul>
<li><code>limit</code> - the limit in bytes</li>
<li><code>length</code> and <code>expected</code> - the expected length of the stream</li>
<li><code>received</code> - the received bytes</li>
<li><code>encoding</code> - the invalid encoding</li>
<li><code>status</code> and <code>statusCode</code> - the corresponding status code for the error</li>
<li><code>type</code> - the error type</li>
</ul>
<h2><a class="anchor" id="autotoc_md2432"></a>
Types</h2>
<p>The errors from this module have a <code>type</code> property which allows for the programmatic determination of the type of error returned.</p>
<h3><a class="anchor" id="autotoc_md2433"></a>
encoding.unsupported</h3>
<p>This error will occur when the <code>encoding</code> option is specified, but the value does not map to an encoding supported by the <a href="https://www.npmjs.org/package/iconv-lite#readme">iconv-lite</a> module.</p>
<h3><a class="anchor" id="autotoc_md2434"></a>
entity.too.large</h3>
<p>This error will occur when the <code>limit</code> option is specified, but the stream has an entity that is larger.</p>
<h3><a class="anchor" id="autotoc_md2435"></a>
request.aborted</h3>
<p>This error will occur when the request stream is aborted by the client before reading the body has finished.</p>
<h3><a class="anchor" id="autotoc_md2436"></a>
request.size.invalid</h3>
<p>This error will occur when the <code>length</code> option is specified, but the stream has emitted more bytes.</p>
<h3><a class="anchor" id="autotoc_md2437"></a>
stream.encoding.set</h3>
<p>This error will occur when the given stream has an encoding set on it, making it a decoded stream. The stream should not have an encoding set and is expected to emit <code>Buffer</code> objects.</p>
<h1><a class="anchor" id="autotoc_md2438"></a>
Examples</h1>
<h2><a class="anchor" id="autotoc_md2439"></a>
Simple Express example</h2>
<div class="fragment"><div class="line">var contentType = require(&#39;content-type&#39;)</div>
<div class="line">var express = require(&#39;express&#39;)</div>
<div class="line">var getRawBody = require(&#39;raw-body&#39;)</div>
<div class="line"> </div>
<div class="line">var app = express()</div>
<div class="line"> </div>
<div class="line">app.use(function (req, res, next) {</div>
<div class="line">  getRawBody(req, {</div>
<div class="line">    length: req.headers[&#39;content-length&#39;],</div>
<div class="line">    limit: &#39;1mb&#39;,</div>
<div class="line">    encoding: contentType.parse(req).parameters.charset</div>
<div class="line">  }, function (err, string) {</div>
<div class="line">    if (err) return next(err)</div>
<div class="line">    req.text = string</div>
<div class="line">    next()</div>
<div class="line">  })</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">// now access req.text</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2440"></a>
Simple Koa example</h2>
<div class="fragment"><div class="line">var contentType = require(&#39;content-type&#39;)</div>
<div class="line">var getRawBody = require(&#39;raw-body&#39;)</div>
<div class="line">var koa = require(&#39;koa&#39;)</div>
<div class="line"> </div>
<div class="line">var app = koa()</div>
<div class="line"> </div>
<div class="line">app.use(function * (next) {</div>
<div class="line">  this.text = yield getRawBody(this.req, {</div>
<div class="line">    length: this.req.headers[&#39;content-length&#39;],</div>
<div class="line">    limit: &#39;1mb&#39;,</div>
<div class="line">    encoding: contentType.parse(this.req).parameters.charset</div>
<div class="line">  })</div>
<div class="line">  yield next</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">// now access this.text</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2441"></a>
Using as a promise</h2>
<p>To use this library as a promise, simply omit the <code>callback</code> and a promise is returned, provided that a global <code>Promise</code> is defined.</p>
<div class="fragment"><div class="line">var getRawBody = require(&#39;raw-body&#39;)</div>
<div class="line">var http = require(&#39;http&#39;)</div>
<div class="line"> </div>
<div class="line">var server = http.createServer(function (req, res) {</div>
<div class="line">  getRawBody(req)</div>
<div class="line">    .then(function (buf) {</div>
<div class="line">      res.statusCode = 200</div>
<div class="line">      res.end(buf.length + &#39; bytes submitted&#39;)</div>
<div class="line">    })</div>
<div class="line">    .catch(function (err) {</div>
<div class="line">      res.statusCode = 500</div>
<div class="line">      res.end(err.message)</div>
<div class="line">    })</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">server.listen(3000)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2442"></a>
Using with TypeScript</h2>
<div class="fragment"><div class="line">import * as getRawBody from &#39;raw-body&#39;;</div>
<div class="line">import * as http from &#39;http&#39;;</div>
<div class="line"> </div>
<div class="line">const server = http.createServer((req, res) =&gt; {</div>
<div class="line">  getRawBody(req)</div>
<div class="line">  .then((buf) =&gt; {</div>
<div class="line">    res.statusCode = 200;</div>
<div class="line">    res.end(buf.length + &#39; bytes submitted&#39;);</div>
<div class="line">  })</div>
<div class="line">  .catch((err) =&gt; {</div>
<div class="line">    res.statusCode = err.statusCode;</div>
<div class="line">    res.end(err.message);</div>
<div class="line">  });</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">server.listen(3000);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2443"></a>
License</h1>
<p>[MIT](LICENSE) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
